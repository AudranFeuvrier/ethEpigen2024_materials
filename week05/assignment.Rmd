---
title: "assignment"
author: "Audran Feuvrier"
date: "2024-03-31"
output: html_document
---

```{r}
suppressPackageStartupMessages({
  library(AnnotationHub)
  library(rtracklayer)
  library(epiwraps)
  library(GenomicRanges)
})
ah <- AnnotationHub()
```

    
Using the peaks you downloaded last week, identify bivalent domains (H3K27me3 + H3K4me3) in mouse embryonic stem cells (mESC)
    
```{r}
path_to_peaks="C:/Users/Audran/Documents/ETHZ Master/Bioinformatical approaches to regulatory genomics and epigenetics/assignments/week4/assignment peaks files"

#Load in peaks for each P300 and markers
peaks_H3K4me3  <- rtracklayer::import(paste(path_to_peaks, "ENCFF671UNN.bed", sep="/"), format="narrowPeak")

peaks_H3K27me3 <- rtracklayer::import(paste(path_to_peaks, "ENCFF055QNY.bed", sep="/"), format="narrowPeak")

bivalent= subsetByOverlaps(peaks_H3K4me3, peaks_H3K27me3) 
bivalent

```

Question: what happens to those regions upon differentiation?
        Choose one differentiated cell type (e.g. hepatocytes, neural progenitor, or smooth muscle cells)
        Download the H3K27me3 and H3K4me3 peaks from this cell type
        How many of the mESC bivalent domains are, in this differentiated cell type, overlapping either mark or their combination (in this differentiated cell type)?


```{r}
peaks_H3K4me3_hep  <- rtracklayer::import(paste(path_to_peaks, "ENCFF692VTG.bed", sep="/"), format="narrowPeak")

peaks_H3K27me3_hep <- rtracklayer::import(paste(path_to_peaks, "ENCFF251NKN.bed", sep="/"), format="narrowPeak")

#overlaps between bivalent domains in mESC and H3K4me3 mouse differentiated hepatocytes
length(overlapsAny(bivalent, peaks_H3K4me3_hep)[overlapsAny(bivalent, peaks_H3K4me3_hep)]==TRUE)

```

```{r}

#overlaps between bivalent domains in mESC and H3K27me3 mouse differentiated hepatocytes marks
length(overlapsAny(bivalent, peaks_H3K27me3_hep)[overlapsAny(bivalent, peaks_H3K27me3_hep)==TRUE])
```

```{r}
#overlaps between bivalent domains in mESC and H3K4me3+H3K27me3 mouse differentiated hepatocytes marks
combination=subsetByOverlaps(peaks_H3K4me3_hep, peaks_H3K27me3_hep)
length(overlapsAny(bivalent, combination)[overlapsAny(bivalent, combination)==TRUE])

```


